## ADR-003: Вибір методу генерації унікального токена користувача

**Статус**: Прийнято </br>
**Дата**: 2025-05-17 </br>
**Автор**: Kasian Anna</br>

### Контекст
Для безпечного та надійного функціонування системи сповіщень необхідно
генерувати унікальні токени, які використовуватимуться для:
* Ідентифікації та відстеження підписок користувачів
* Підтвердження дій користувача (підписка, відписка) через унікальні посилання
* Захист від повторного використання або підробки підтверджень

### Розглянуті варіанти
1. UUID (Universally Unique Identifier)
   * Генерація за допомогою UUID npm Package
       * **Плюси:** стандартизований підхід; важко підібрати; гарантована унікальність; широко підтримується; легко реалізовувати
       * **Мінуси:** додаткова залежність; передбачуваність структури
   * Автоматична генерація на рівні БД (PostgreSQL)
        * **Плюси:** автоматичне збереження в БД; важко підібрати; інтеграція з наявною архітектурою; висока продуктивність
        * **Мінуси:** можливі помилки при дублікатах; залежність від специфічної БД
2. Випадкові рядки
    * **Плюси:** важко підібрати; гнучкість у довжині та форматі 
    * **Мінуси:** необхідно знайти надійний спосіб генерувати; потреба у перевірці унікальності; ризик колізій
3. Криптографічні хеші
    * **Плюси:** високий рівень безпеки; фіксована довжина
    * **Мінуси:** можуть дублікуватись при однакових вхідних даних; складніша реалізація для випадкових значень
4. Послідовність випадкових чисел
    * **Плюси:** легко реалізувати; мінімальні обчислювальні ресурси
    * **Мінуси:** може повторюватись, потребує додаткової перевірки; низький рівень безпеки; легко передбачити
5. JWT
    * **Плюси:** високий рівень безпеки та шифрування; можливість зберігати додаткові дані; верифікація без звернення до бд
    * **Мінуси:** складніша реалізація; більший розмір токена; потреба в управлінні секретними ключами
6. HMAC-токени
    * **Плюси:** високий рівень безпеки; верифікація цілісності; захист від підробки
    * **Мінуси:** складна реалізація; потреба в управлінні секретними ключами

### Прийняте рішення
Обрано автоматичну генерацію UUID на рівні PostgreSQL БД.

### Наслідки

#### Позитивні
* Токен завжди автоматично генерується та зберігається в 
БД разом з іншими даними користувача
* Спрощене отримання токена для надсилання повідомлень користувачу
* Атомарність операцій створення користувача та токена
* Можливість використання валідацій ORM та обробки помилок
* Висока продуктивність

#### Негативні
* Потенційні помилки при генерації дублікатів 
(хоча ймовірність вкрай низька для UUID)
* Залежність від PostgreSQL функціональності
* Необхідність обробки виключних ситуацій при збереженні